# **ì„œë¹„ìŠ¤ ê°œìš”**

"ì—°ë½ì²˜ ì† 500ëª…, ë‹¹ì‹ ì€ ê·¸ì¤‘ 5ëª…ë§Œ ê¸°ì–µí•©ë‹ˆë‹¤. ë‚˜ë¨¸ì§€ 495ëª…ì´ ë‹¹ì‹ ì˜ ê¸°íšŒì…ë‹ˆë‹¤."
íˆ¬ììë¥¼ ë§Œë‚˜ê³  ì‹¶ê±°ë‚˜, êµ¬ê¸€ì— ì§€ì›í•˜ê³  ì‹¶ê±°ë‚˜, íŠ¹ì • ì—…ê³„ ì „ë¬¸ê°€ì™€ ì—°ê²°ë˜ê³  ì‹¶ì„ ë•Œ â€” ë‹¹ì‹ ì€ ë¶„ëª… ê·¸ ì‚¬ëŒì„ ì•„ëŠ” ëˆ„êµ°ê°€ë¥¼ ì•Œê³  ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ëˆ„êµ°ì§€, ì–´ë–»ê²Œ ë¶€íƒí•´ì•¼ í• ì§€ ëª¨ë¦…ë‹ˆë‹¤.
GATSëŠ” AIë¡œ ë‹¹ì‹ ì˜ ì „ì²´ ë„¤íŠ¸ì›Œí¬ë¥¼ ë¶„ì„í•´ì„œ ê°€ì¥ ì§§ì€ ì—°ê²° ê²½ë¡œë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. "ì‹œë¦¬ì¦ˆ A íˆ¬ììë¥¼ ë§Œë‚˜ê³  ì‹¶ë‹¤"ê³  í•˜ë©´, "ë¯¼ìˆ˜ì—ê²Œ ë¶€íƒ â†’ ë¯¼ìˆ˜ê°€ ì§€í˜œë¥¼ ì—°ê²° â†’ ì§€í˜œê°€ ê·¸ íˆ¬ììì™€ ê³¨í”„ ì¹œêµ¬"ë¼ê³  ì•Œë ¤ì¤ë‹ˆë‹¤.
ê° ë‹¨ê³„ë§ˆë‹¤ ë‹¹ì‚¬ìê°€ ë™ì˜í•´ì•¼ë§Œ ì—°ê²°ë˜ê¸° ë•Œë¬¸ì—, ì‹ ë¢°ëŠ” ìœ ì§€ë©ë‹ˆë‹¤.
ì ìë˜ ì¸ë§¥ì„ ë‹¹ì‹ ì˜ ìµœê°• ë¬´ê¸°ë¡œ ë§Œë“¤ì–´ë“œë¦½ë‹ˆë‹¤ â€” ë˜‘ë˜‘í•œ ì†Œê°œ, ë‹¨ í•œ ë²ˆìœ¼ë¡œ.

í•µì‹¬ ì‚¬ìš©ì ê°€ì¹˜:
"ë‚´ê°€ ì´ë¯¸ ì•„ëŠ” ì‚¬ëŒë“¤ì„ í†µí•´, í•„ìš”í•œ ëˆ„êµ¬ë“  ë§Œë‚  ìˆ˜ ìˆë‹¤."

# **GATS MVP í•µì‹¬ User Stories (ì‚¬ìš©ì ì—¬ì • ìˆœì„œ)**

---

## **1ë‹¨ê³„: ì˜¨ë³´ë”© & ë„¤íŠ¸ì›Œí¬ êµ¬ì¶•**

**US-01. ì²« í”„ë¡œí•„ ìƒì„±**
- *As a* ìƒˆ ì‚¬ìš©ì,
- *I want to* ë‚´ ê¸°ë³¸ ì •ë³´(ì´ë¦„, í•™êµ, íšŒì‚¬, ê´€ì‹¬ì‚¬)ë¥¼ 5ë¶„ ì•ˆì— ì…ë ¥í•˜ê³ 
- *So that* ë‹¤ë¥¸ ì‚¬ëŒë“¤ì´ ë‚˜ë¥¼ ì°¾ê³  ì—°ê²°í•  ìˆ˜ ìˆë‹¤.

**US-02. ì—°ë½ì²˜ ë™ê¸°í™”**
- *As a* ì‚¬ìš©ì,
- *I want to* ë‚´ ì—°ë½ì²˜ë¥¼ í•œ ë²ˆì˜ í´ë¦­ìœ¼ë¡œ ë™ê¸°í™”í•˜ê³ 
- *So that* GATSê°€ ë‚´ ë„¤íŠ¸ì›Œí¬ì˜ ê¸°ë³¸ êµ¬ì¡°ë¥¼ íŒŒì•…í•  ìˆ˜ ìˆë‹¤.

**US-03. ë„¤íŠ¸ì›Œí¬ ì´ˆê¸° ë§¤ì¹­**
- *As a* ì‚¬ìš©ì,
- *I want to* ë‚´ ì—°ë½ì²˜ ì¤‘ ëˆ„ê°€ ì´ë¯¸ GATSë¥¼ ì“°ê³  ìˆëŠ”ì§€ ìë™ìœ¼ë¡œ í™•ì¸ë˜ê³ 
- *So that* ì¦‰ì‹œ ì—°ê²° ê°€ëŠ¥í•œ ë„¤íŠ¸ì›Œí¬ê°€ í˜•ì„±ëœë‹¤.

---

## **2ë‹¨ê³„: ë„¤íŠ¸ì›Œí¬ ì´í•´í•˜ê¸°**

**US-04. ë„¤íŠ¸ì›Œí¬ ì‹œê°í™” ë§µ ë³´ê¸°**
- *As a* ì‚¬ìš©ì,
- *I want to* ë‚´ ì¸ë§¥ì„ ê·¸ë£¹ë³„(í•™êµ/íšŒì‚¬/ì·¨ë¯¸ ë“±)ë¡œ í´ëŸ¬ìŠ¤í„°ë§ëœ ë§µìœ¼ë¡œ ë³´ê³ 
- *So that* ë‚´ê°€ ì–´ë–¤ ë„¤íŠ¸ì›Œí¬ë¥¼ ê°€ì§€ê³  ìˆëŠ”ì§€ í•œëˆˆì— ì´í•´í•  ìˆ˜ ìˆë‹¤.

---

## **3ë‹¨ê³„: ì—°ê²° ì°¾ê¸° (í•µì‹¬ ê°€ì¹˜)**

**US-05. AIì—ê²Œ ì—°ê²° ìš”ì²­í•˜ê¸°**
- *As a* ì‚¬ìš©ì,
- *I want to* "ì‹œë¦¬ì¦ˆ A íˆ¬ìì ì°¾ì•„ì¤˜" ë˜ëŠ” "ë„¤ì´ë²„ ë‹¤ë‹ˆëŠ” ê°œë°œì ì†Œê°œë°›ê³  ì‹¶ì–´" ê°™ì€ ìì—°ì–´ë¡œ ìš”ì²­í•˜ê³ 
- *So that* AIê°€ ë‚´ ë„¤íŠ¸ì›Œí¬ë¥¼ ê²€ìƒ‰í•´ì„œ ê°€ëŠ¥í•œ ê²½ë¡œë¥¼ ì°¾ì•„ì¤€ë‹¤.

**US-06. ì—°ê²° ê²½ë¡œ í™•ì¸**
- *As a* ì‚¬ìš©ì,
- *I want to* "ë‚˜ â†’ A(ì¹œêµ¬) â†’ B(ì¹œêµ¬ì˜ ì¹œêµ¬) â†’ ëª©í‘œ ì¸ë¬¼" í˜•íƒœë¡œ ìµœë‹¨ ê²½ë¡œë¥¼ ì‹œê°ì ìœ¼ë¡œ ë³´ê³ 
- *So that* ì–´ë–¤ ë£¨íŠ¸ë¡œ ì ‘ê·¼í• ì§€ ì„ íƒí•  ìˆ˜ ìˆë‹¤.

---

## **4ë‹¨ê³„: ì—°ê²° ìš”ì²­ & ì¤‘ê°„ì ë™ì˜**

**US-07. ì¤‘ê°„ ì—°ê²°ìì—ê²Œ ìš”ì²­ ë³´ë‚´ê¸°**
- *As a* ì‚¬ìš©ì,
- *I want to* ì„ íƒí•œ ê²½ë¡œì˜ ì²« ë²ˆì§¸ ì‚¬ëŒ(ë‚´ ì¹œêµ¬)ì—ê²Œ "ì´ ì‚¬ëŒ ì†Œê°œ ì¢€ ë¶€íƒí•´ë„ ë ê¹Œ?"ë¼ëŠ” ë©”ì‹œì§€ë¥¼ í…œí”Œë¦¿ìœ¼ë¡œ ë³´ë‚´ê³ 
- *So that* ë¶€ë‹´ ì—†ì´ ë„ì›€ì„ ìš”ì²­í•  ìˆ˜ ìˆë‹¤.

**US-08. ì¤‘ê°„ìì˜ ë™ì˜/ê±°ì ˆ ì²˜ë¦¬**
- *As a* ì¤‘ê°„ ì—°ê²°ì,
- *I want to* ì†Œê°œ ìš”ì²­ì„ ë°›ìœ¼ë©´ "ìˆ˜ë½" ë˜ëŠ” "ì •ì¤‘íˆ ê±°ì ˆ" ë²„íŠ¼ìœ¼ë¡œ ì‘ë‹µí•˜ê³ 
- *So that* ë‚´ê°€ í¸í•œ ë²”ìœ„ ë‚´ì—ì„œë§Œ ë„¤íŠ¸ì›Œí¬ë¥¼ ê³µìœ í•  ìˆ˜ ìˆë‹¤.

---

## **5ë‹¨ê³„: ì—°ê²° ì„±ì‚¬**

**US-09. ìµœì¢… ì—°ê²° ì•Œë¦¼**
- *As a* ìš”ì²­ì,
- *I want to* ëª¨ë“  ì¤‘ê°„ìê°€ ë™ì˜í•˜ë©´ ìµœì¢… ëª©í‘œ ì¸ë¬¼ì˜ ì—°ë½ì²˜(ë˜ëŠ” ì†Œê°œ ë©”ì‹œì§€)ë¥¼ ë°›ê³ 
- *So that* ì§ì ‘ ì—°ë½ì„ ì‹œì‘í•  ìˆ˜ ìˆë‹¤.

---

## **ëŠê¸´ ê³ ë¦¬ ì—†ëŠ” ìµœì†Œ ì—¬ì • (MVP Core Flow)**

ê°€ì… â†’ í”„ë¡œí•„ ì…ë ¥ â†’ ì—°ë½ì²˜ ë™ê¸°í™” â†’ 
ë§µ í™•ì¸ â†’ "â—‹â—‹ ì°¾ì•„ì¤˜" ìš”ì²­ â†’ ê²½ë¡œ í™•ì¸ â†’ 
ì¤‘ê°„ìì—ê²Œ ìš”ì²­ â†’ ì¤‘ê°„ì ìˆ˜ë½ â†’ ìµœì¢… ì—°ê²° â†’ í”¼ë“œë°±


ì´ ê¸°ëŠ¥ë“¤ë§Œ ìˆì–´ë„ í•µì‹¬ ê°€ì¹˜ì¸ **"ì ìëŠ” ì¸ë§¥ìœ¼ë¡œ í•„ìš”í•œ ì‚¬ëŒ ì°¾ê¸°"**ëŠ” ì‘ë™í•©ë‹ˆë‹¤.

# ğŸ“ GATS í”„ë¡œì íŠ¸ ì „ì²´ êµ¬ì¡° (DDD ê¸°ë°˜)
**DB ë° ë°±ì—”ë“œ ê³„ì¸µ ì„¤ê³„ ì™„ë£Œ, í”„ë¡ íŠ¸ì—”ë“œ ê³„ì¸µì€ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ êµ¬í˜„**

## ğŸ—ï¸ ì „ì²´ í´ë” êµ¬ì¡°

```
gats/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ user/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ profile/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ verify-phone/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ contact/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ sync/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ match/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ network/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ map/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ nodes/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ clusters/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ path/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ search/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ route.ts
â”‚   â”‚   â”‚   â””â”€â”€ introduction/
â”‚   â”‚   â”‚       â”œâ”€â”€ request/
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ [id]/
â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ respond/
â”‚   â”‚   â”‚       â”‚   â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚       â”‚   â””â”€â”€ route.ts
â”‚   â”‚   â”‚       â””â”€â”€ route.ts
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ domain/
â”‚   â”‚   â”‚   â”œâ”€â”€ user/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ backend/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ UserService.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ AuthService.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ ProfileService.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ UserRepo.interface.ts
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ SqliteUserRepo.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ contact/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ backend/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ ContactSyncService.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ ContactMatchService.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ EncryptionService.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ ContactRepo.interface.ts
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ SqliteContactRepo.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ networkNode/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ backend/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ NetworkMapService.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ NodeClusteringService.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ NodeEstimationService.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ NetworkNodeRepo.interface.ts
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ SqliteNetworkNodeRepo.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ connection/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ backend/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ ConnectionService.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ ConnectionStrengthCalculator.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ ConnectionRepo.interface.ts
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ SqliteConnectionRepo.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ pathRequest/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ backend/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ PathFinderService.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ QueryParserService.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ PathRankingService.ts
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ PathRequestRepo.interface.ts
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ SqlitePathRequestRepo.ts
â”‚   â”‚   â”‚   â””â”€â”€ introductionFlow/
â”‚   â”‚   â”‚       â”œâ”€â”€ types.ts
â”‚   â”‚   â”‚       â””â”€â”€ backend/
â”‚   â”‚   â”‚           â”œâ”€â”€ IntroductionOrchestrator.ts
â”‚   â”‚   â”‚           â”œâ”€â”€ NotificationService.ts
â”‚   â”‚   â”‚           â”œâ”€â”€ TemplateService.ts
â”‚   â”‚   â”‚           â”œâ”€â”€ IntroductionRepo.interface.ts
â”‚   â”‚   â”‚           â””â”€â”€ SqliteIntroductionRepo.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ security/
â”‚   â”‚   â”‚   â”œâ”€â”€ crypto.ts
â”‚   â”‚   â”‚   â””â”€â”€ phoneValidator.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ sqlite/
â”‚   â”‚       â”œâ”€â”€ db.ts
â”‚   â”‚       â”œâ”€â”€ migrations/
â”‚   â”‚       â”‚   â”œâ”€â”€ 001_create_users_table.sql
â”‚   â”‚       â”‚   â”œâ”€â”€ 002_create_contacts_table.sql
â”‚   â”‚       â”‚   â”œâ”€â”€ 003_create_network_nodes_table.sql
â”‚   â”‚       â”‚   â”œâ”€â”€ 004_create_connections_table.sql
â”‚   â”‚       â”‚   â”œâ”€â”€ 005_create_path_requests_table.sql
â”‚   â”‚       â”‚   â””â”€â”€ 006_create_introduction_flows_table.sql
â”‚   â”‚       â””â”€â”€ scripts/
â”‚   â”‚           â”œâ”€â”€ migrate.ts
â”‚   â”‚           â””â”€â”€ seed.ts
â”‚   â”‚
â”‚   â””â”€â”€ middleware.ts
â”‚
â”œâ”€â”€ .env.local
â”œâ”€â”€ package.json
â””â”€â”€ tsconfig.json
```

## ğŸ“ Domain Types ì „ì²´ ì •ì˜

### 1ï¸âƒ£ **User Domain**

```typescript
// src/lib/domain/user/types.ts
export interface User {
  id: string
  clerkUserId?: string           // Clerk ì—°ë™
  phoneNumber: string             // ì•”í˜¸í™” ì €ì¥
  phoneHash: string               // ë§¤ì¹­ìš© í•´ì‹œ
  name: string
  company?: string
  school?: string
  interests: string[]
  profileVisibility: 'public' | 'connections_only' | 'ghost_mode'
  userSalt: string                // ê°œì¸ë³„ salt
  isVerified: boolean             // ì „í™”ë²ˆí˜¸ ì¸ì¦ ì—¬ë¶€
  createdAt: Date
  updatedAt: Date
  lastSyncAt?: Date
}

export interface CreateUserInput {
  clerkUserId?: string
  phoneNumber: string
  name: string
  company?: string
  school?: string
  interests?: string[]
}

export interface UpdateUserInput {
  name?: string
  company?: string
  school?: string
  interests?: string[]
  profileVisibility?: 'public' | 'connections_only' | 'ghost_mode'
}

export interface PhoneVerificationRequest {
  phoneNumber: string
  code?: string
}

export interface PhoneVerificationResponse {
  verificationId: string
  status: 'pending' | 'verified'
  expiresAt: Date
}

export interface UserProfile {
  id: string
  name: string
  company?: string
  school?: string
  interests: string[]
  profileVisibility: string
  connectionCount?: number
  isVerified: boolean
}
```

### 2ï¸âƒ£ **Contact Domain**

```typescript
// src/lib/domain/contact/types.ts
export interface Contact {
  id: string
  userId: string                  // ì†Œìœ ì
  phoneHash: string               // bcrypt í•´ì‹œ (ë§¤ì¹­ìš©)
  encryptedPhone: string          // AES ì•”í˜¸í™” (í‘œì‹œìš©)
  encryptedName: string           // AES ì•”í˜¸í™”
  originalName: string            // ì—°ë½ì²˜ ì›ë³¸ ì´ë¦„
  matchedUserId?: string          // GATS ì‚¬ìš©ì ë§¤ì¹­
  tags: string[]                  // ê·¸ë£¹ íƒœê·¸
  syncedAt: Date
  createdAt: Date
}

export interface ContactSyncBatch {
  userId: string
  contacts: RawContact[]
  syncId: string                  // ë™ê¸°í™” ì„¸ì…˜ ID
  timestamp: Date
}

export interface RawContact {
  phoneNumber: string
  name: string
  tags?: string[]
}

export interface ContactMatch {
  contactId: string
  matchedUserId: string
  matchConfidence: number         // 0-100
  matchedAt: Date
}

export interface ContactSyncResult {
  totalContacts: number
  newContacts: number
  updatedContacts: number
  matchedUsers: number
  errors: string[]
}

export interface ContactGroup {
  id: string
  userId: string
  name: string
  contactIds: string[]
  color?: string
  createdAt: Date
}
```

### 3ï¸âƒ£ **NetworkNode Domain**

```typescript
// src/lib/domain/networkNode/types.ts
export interface NetworkNode {
  id: string
  userId: string                   // ë„¤íŠ¸ì›Œí¬ ì†Œìœ ì
  nodeType: 'user' | 'contact'
  targetUserId?: string            // user íƒ€ì…ì¼ ë•Œ
  contactId?: string               // contact íƒ€ì…ì¼ ë•Œ
  
  // í‘œì‹œ ì •ë³´
  displayName: string
  initials: string                 // ì•„ë°”íƒ€ìš©
  avatarUrl?: string
  
  // AI ì¶”ì • ì •ë³´
  estimatedInfo?: {
    company?: string
    school?: string
    role?: string
    location?: string
    confidence: number             // 0-100
    source: 'profile' | 'common_contacts' | 'pattern'
  }
  
  // ì‹œê°í™” ì •ë³´
  visualization: {
    position: { x: number; y: number }
    clusterId?: string
    color?: string                 // í´ëŸ¬ìŠ¤í„° ìƒ‰ìƒ
    size: number                   // ë…¸ë“œ í¬ê¸° (ì—°ê²° ìˆ˜ ê¸°ë°˜)
    layer: number                  // 0=ë‚˜, 1=1ì´Œ, 2=2ì´Œ
  }
  
  // ë©”íƒ€ë°ì´í„°
  connectionCount: number          // ì—°ê²°ëœ ë…¸ë“œ ìˆ˜
  isHidden: boolean
  isPinned: boolean                // ê³ ì • ë…¸ë“œ
  updatedAt: Date
}

export interface NetworkCluster {
  id: string
  userId: string
  name: string                     // "ëŒ€í•™ ë™ê¸°", "í˜„ ì§ì¥" ë“±
  type: 'school' | 'company' | 'location' | 'custom'
  nodeIds: string[]
  color: string
  centroid: { x: number; y: number }
  metadata?: {
    schoolName?: string
    companyName?: string
    location?: string
  }
}

export interface NetworkMapView {
  userId: string
  zoom: number
  center: { x: number; y: number }
  visibleClusters: string[]
  hiddenNodes: string[]
  selectedNodeId?: string
  filterCriteria?: {
    nodeType?: 'user' | 'contact' | 'all'
    clusters?: string[]
    searchTerm?: string
  }
}

export interface NetworkMapData {
  nodes: NetworkNode[]
  clusters: NetworkCluster[]
  connections: Array<{
    fromNodeId: string
    toNodeId: string
    strength: number
  }>
  stats: {
    totalNodes: number
    totalConnections: number
    avgConnectionStrength: number
  }
}
```

### 4ï¸âƒ£ **Connection Domain**

```typescript
// src/lib/domain/connection/types.ts
export interface Connection {
  id: string
  userId: string                   // ì—°ê²° ì†Œìœ ì
  fromNodeId: string
  toNodeId: string
  
  // ê´€ê³„ ì •ë³´
  strength: number                 // 0-100
  type: ConnectionType
  isMutual: boolean                // ì–‘ë°©í–¥ ì €ì¥ ì—¬ë¶€
  isActive: boolean                // í™œì„± ì—°ê²°
  
  // ê´€ê³„ ë§¥ë½
  context?: {
    source: 'contact' | 'introduction' | 'inferred'
    sharedGroups?: string[]        // ê³µí†µ ê·¸ë£¹/í´ëŸ¬ìŠ¤í„°
    lastInteraction?: Date
    interactionCount?: number
  }
  
  createdAt: Date
  updatedAt: Date
}

export type ConnectionType = 
  | 'friend'
  | 'colleague'
  | 'family'
  | 'schoolmate'
  | 'business'
  | 'other'

export interface ConnectionStrength {
  connectionId: string
  factors: {
    mutualContact: number           // ì–‘ë°©í–¥ ì €ì¥ (0 or 40)
    sharedConnections: number       // ê³µí†µ ì§€ì¸ ìˆ˜ (0-30)
    sameCluster: number             // ê°™ì€ ê·¸ë£¹ (0-20)
    recentInteraction: number       // ìµœê·¼ ìƒí˜¸ì‘ìš© (0-10)
  }
  totalScore: number                // 0-100
  calculatedAt: Date
}

export interface ConnectionAnalysis {
  userId: string
  strongConnections: string[]      // 70+ strength
  mediumConnections: string[]       // 40-69 strength
  weakConnections: string[]         // 0-39 strength
  bridgeNodes: string[]             // ë‹¤ë¥¸ í´ëŸ¬ìŠ¤í„° ì—°ê²° ë…¸ë“œ
  isolatedNodes: string[]           // ì—°ê²° ì—†ëŠ” ë…¸ë“œ
}
```

### 5ï¸âƒ£ **PathRequest Domain**

```typescript
// src/lib/domain/pathRequest/types.ts
export interface PathRequest {
  id: string
  userId: string
  
  // ê²€ìƒ‰ ì¿¼ë¦¬
  query: string                     // ì›ë³¸ ìì—°ì–´ ì¿¼ë¦¬
  queryType: 'natural' | 'structured'
  
  // íŒŒì‹±ëœ ê²€ìƒ‰ ì¡°ê±´
  parsedCriteria: {
    companies?: string[]            // ["ë„¤ì´ë²„", "ì¹´ì¹´ì˜¤"]
    schools?: string[]
    roles?: string[]                // ["ê°œë°œì", "ë””ìì´ë„ˆ"]
    skills?: string[]
    keywords?: string[]             // ê¸°íƒ€ í‚¤ì›Œë“œ
    location?: string
  }
  
  // ê²€ìƒ‰ ì„¤ì •
  searchConfig: {
    maxDepth: number                // ìµœëŒ€ ì´Œìˆ˜ (2 or 3)
    maxResults: number              // ìµœëŒ€ ê²°ê³¼ ìˆ˜
    minConfidence: number           // ìµœì†Œ ì‹ ë¢°ë„
    includeNonUsers: boolean        // ë¹„ê°€ì…ì í¬í•¨
  }
  
  // ê²€ìƒ‰ ê²°ê³¼
  results: PathResult[]
  
  // ë©”íƒ€ë°ì´í„°
  status: 'pending' | 'processing' | 'completed' | 'failed'
  processedAt?: Date
  createdAt: Date
}

export interface PathResult {
  id: string
  requestId: string
  
  // ê²½ë¡œ ì •ë³´
  path: PathNode[]                  // ìƒì„¸ ê²½ë¡œ ë…¸ë“œ
  depth: number                     // ì´Œìˆ˜
  
  // í‰ê°€ ì§€í‘œ
  confidence: number                // 0-100 (ë§¤ì¹­ ì •í™•ë„)
  pathStrength: number              // 0-100 (ê²½ë¡œ ê°•ë„)
  
  // íƒ€ê²Ÿ ì •ë³´
  targetNode: {
    nodeId: string
    userId?: string                 // ê°€ì…ìì¸ ê²½ìš°
    name: string
    company?: string
    role?: string
    matchedCriteria: string[]       // ë§¤ì¹­ëœ ì¡°ê±´ë“¤
  }
  
  rank: number                      // ìˆœìœ„
}

export interface PathNode {
  nodeId: string
  userId?: string
  name: string
  company?: string
  role?: string
  connectionStrength: number        // ì´ì „ ë…¸ë“œì™€ì˜ ì—°ê²° ê°•ë„
  isGatsUser: boolean
}

export interface ParsedQuery {
  intent: 'find_person' | 'find_role' | 'find_company'
  entities: {
    companies: string[]
    roles: string[]
    skills: string[]
    names: string[]
    locations: string[]
  }
  confidence: number
}

export interface SearchHistory {
  userId: string
  searches: Array<{
    query: string
    timestamp: Date
    resultCount: number
  }>
}
```

### 6ï¸âƒ£ **IntroductionFlow Domain**

```typescript
// src/lib/domain/introductionFlow/types.ts
export interface IntroductionFlow {
  id: string
  pathRequestId: string             // ì›ë³¸ ê²€ìƒ‰ ìš”ì²­
  requesterId: string                // ìš”ì²­ì
  targetNodeId: string               // ìµœì¢… ëª©í‘œ
  
  // ê²½ë¡œ ì •ë³´
  path: string[]                    // ì‚¬ìš©ì ID ë°°ì—´
  pathDetails: IntroductionNode[]   // ìƒì„¸ ê²½ë¡œ ì •ë³´
  
  // ìƒíƒœ ê´€ë¦¬
  currentStep: number
  status: IntroductionStatus
  
  // ë‹¨ê³„ë³„ ì§„í–‰
  steps: IntroductionStep[]
  
  // ë©”ì‹œì§€ í…œí”Œë¦¿
  messageTemplate?: {
    subject: string
    body: string
    variables: Record<string, string>
  }
  
  // ìµœì¢… ê²°ê³¼
  completionInfo?: {
    sharedContact?: {
      phoneNumber: string
      name: string
    }
    introductionMessage?: string
    completedAt: Date
  }
  
  // ë©”íƒ€ë°ì´í„°
  expiresAt: Date                   // 72ì‹œê°„ í›„
  createdAt: Date
  updatedAt: Date
}

export type IntroductionStatus = 
  | 'draft'                          // ì‘ì„± ì¤‘
  | 'pending'                        // ëŒ€ê¸° ì¤‘
  | 'in_progress'                    // ì§„í–‰ ì¤‘
  | 'completed'                      // ì™„ë£Œ
  | 'failed'                         // ì‹¤íŒ¨
  | 'expired'                        // ë§Œë£Œ
  | 'cancelled'                      // ì·¨ì†Œë¨

export interface IntroductionStep {
  stepNumber: number
  fromUserId: string
  toUserId: string
  
  // ìš”ì²­ ì •ë³´
  request: {
    message: string
    sentAt: Date
    expiresAt: Date
  }
  
  // ì‘ë‹µ ì •ë³´
  response?: {
    status: 'accepted' | 'declined'
    message?: string                 // ê±°ì ˆ ì‚¬ìœ  ë“±
    respondedAt: Date
  }
  
  // ì•Œë¦¼ ì„¤ì •
  notifications: {
    reminderSent: boolean
    reminderCount: number
  }
}

export interface IntroductionNode {
  userId: string
  name: string
  company?: string
  role?: string
  relationToNext?: string           // "ëŒ€í•™ ë™ê¸°", "ì „ ì§ì¥ ë™ë£Œ" ë“±
}

export interface IntroductionTemplate {
  id: string
  name: string
  category: 'business' | 'job' | 'investment' | 'general'
  subject: string
  body: string
  variables: string[]               // ["requesterName", "targetRole", ...]
  isDefault: boolean
}

export interface IntroductionNotification {
  flowId: string
  stepNumber: number
  userId: string                    // ìˆ˜ì‹ ì
  type: 'new_request' | 'reminder' | 'accepted' | 'declined' | 'completed'
  sentAt: Date
  channel: 'push' | 'email' | 'sms'
  delivered: boolean
}

export interface IntroductionStats {
  userId: string
  totalRequests: number
  successRate: number
  avgCompletionTime: number         // hours
  topIntroducers: Array<{
    userId: string
    name: string
    successCount: number
  }>
}
```

## ğŸ” Clerk í†µí•© (middleware.ts)

```typescript
// src/middleware.ts
import { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'

// Public routes that don't require authentication
const isPublicRoute = createRouteMatcher([
  '/',
  '/sign-in(.*)',
  '/sign-up(.*)',
  '/api/webhooks(.*)',
])

// API routes that require authentication
const isApiRoute = createRouteMatcher([
  '/api/user(.*)',
  '/api/contact(.*)',
  '/api/network(.*)',
  '/api/path(.*)',
  '/api/introduction(.*)',
])

export default clerkMiddleware((auth, req) => {
  // Allow public routes
  if (isPublicRoute(req)) return
  
  // Protect API routes
  if (isApiRoute(req)) {
    auth().protect()
  }
})

export const config = {
  matcher: [
    '/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',
    '/(api|trpc)(.*)',
  ],
}
```

## ğŸ“Š Database Schema

```sql
-- src/lib/sqlite/migrations/001_create_users_table.sql
CREATE TABLE users (
  id TEXT PRIMARY KEY,
  clerk_user_id TEXT UNIQUE,
  phone_number TEXT NOT NULL,  -- encrypted
  phone_hash TEXT NOT NULL UNIQUE,
  name TEXT NOT NULL,
  company TEXT,
  school TEXT,
  interests TEXT,  -- JSON array
  profile_visibility TEXT DEFAULT 'public',
  user_salt TEXT NOT NULL,
  is_verified BOOLEAN DEFAULT FALSE,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  last_sync_at DATETIME
);

CREATE INDEX idx_users_phone_hash ON users(phone_hash);
CREATE INDEX idx_users_clerk_id ON users(clerk_user_id);
```
